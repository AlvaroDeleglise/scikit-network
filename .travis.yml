language: python

matrix:
  include:
    # perform a linux build
        - if: branch = feat/manylinux
          services: docker
          env: DOCKER_IMAGE=quay.io/pypa/manylinux2010_x86_64
               PLAT=manylinux2010_x86_64
          install:
            - pip install codecov
            - docker pull $DOCKER_IMAGE
          script:
            - docker run --rm -e PLAT=$PLAT -v `pwd`:/io $DOCKER_IMAGE $PRE_CMD /io/travis/build-wheels.sh
            - ls wheelhouse/
        # and a mac build
        - os: osx
          language: shell
          install:
            - python3 -m pip install cibuildwheel==1.3.0
          env:
            - CIBW_BEFORE_BUILD="pip install -r requirements_dev.txt && pip install ."
            - CIBW_BUILD="cp36-* cp37-* cp38-*"
            - CIBW_SKIP=*-manylinux*
          script:
              # build the wheels, put them into './wheelhouse'
              - python3 -m cibuildwheel --output-dir wheelhouse
              - ls wheelhouse/
        # and a windows build
        - os: windows
          language: shell
          before_install:
            - choco install python --version 3.8.0
            - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
            # make sure it's on PATH as 'python3'
            - ln -s /c/Python38/python.exe /c/Python38/python3.exe
          install:
              - python3 -m pip install cibuildwheel==1.3.0
          env:
            - CIBW_BEFORE_BUILD="pip install -r requirements_dev.txt && pip install ."
            - CIBW_BUILD="cp36-* cp37-* cp38-*"
            - CIBW_SKIP=*-manylinux*
          script:
              # build the wheels, put them into './wheelhouse'
              - python3 -m cibuildwheel --output-dir wheelhouse
              - ls wheelhouse/


